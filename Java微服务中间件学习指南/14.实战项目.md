# å¾®æœåŠ¡å®æˆ˜é¡¹ç›®

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

### é¡¹ç›®ç®€ä»‹
è¿™æ˜¯ä¸€ä¸ªåŸºäºSpring Cloudçš„å¾®æœåŠ¡ç”µå•†ç³»ç»Ÿï¼ŒåŒ…å«ç”¨æˆ·æœåŠ¡ã€å•†å“æœåŠ¡ã€è®¢å•æœåŠ¡ã€æ”¯ä»˜æœåŠ¡ç­‰æ ¸å¿ƒæ¨¡å—ã€‚

### æŠ€æœ¯æ ˆ
- **æ¡†æ¶**ï¼šSpring Boot 2.7.x + Spring Cloud 2021.0.x
- **æ³¨å†Œä¸­å¿ƒ**ï¼šNacos
- **é…ç½®ä¸­å¿ƒ**ï¼šNacos Config
- **ç½‘å…³**ï¼šSpring Cloud Gateway
- **è´Ÿè½½å‡è¡¡**ï¼šSpring Cloud LoadBalancer
- **æœåŠ¡è°ƒç”¨**ï¼šOpenFeign
- **ç†”æ–­å™¨**ï¼šResilience4j
- **æ•°æ®åº“**ï¼šMySQL + Redis
- **æ¶ˆæ¯é˜Ÿåˆ—**ï¼šRabbitMQ

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

### æ•´ä½“æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       å®¢æˆ·ç«¯                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   Web      â”‚  â”‚   Mobile    â”‚  â”‚   Admin     â”‚        â”‚
â”‚  â”‚  Client    â”‚  â”‚   Client    â”‚  â”‚   Client    â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç½‘å…³æœåŠ¡                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   è·¯ç”±      â”‚  â”‚   è®¤è¯      â”‚  â”‚   é™æµ      â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼             â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·æœåŠ¡   â”‚ â”‚  å•†å“æœåŠ¡   â”‚ â”‚  è®¢å•æœåŠ¡   â”‚
â”‚ ç«¯å£:8081  â”‚ â”‚ ç«¯å£:8082  â”‚ â”‚ ç«¯å£:8083  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚             â”‚             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ”¯ä»˜æœåŠ¡   â”‚ â”‚  åº“å­˜æœåŠ¡   â”‚ â”‚  æ¶ˆæ¯æœåŠ¡   â”‚
â”‚ ç«¯å£:8084  â”‚ â”‚ ç«¯å£:8085  â”‚ â”‚ ç«¯å£:8086  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æœåŠ¡è¯´æ˜
- **ç½‘å…³æœåŠ¡**ï¼šç»Ÿä¸€å…¥å£ï¼Œè·¯ç”±è½¬å‘ï¼Œè®¤è¯é™æµ
- **ç”¨æˆ·æœåŠ¡**ï¼šç”¨æˆ·ç®¡ç†ï¼Œè®¤è¯æˆæƒ
- **å•†å“æœåŠ¡**ï¼šå•†å“ç®¡ç†ï¼Œåˆ†ç±»ç®¡ç†
- **è®¢å•æœåŠ¡**ï¼šè®¢å•å¤„ç†ï¼ŒçŠ¶æ€ç®¡ç†
- **æ”¯ä»˜æœåŠ¡**ï¼šæ”¯ä»˜å¤„ç†ï¼Œé€€æ¬¾å¤„ç†
- **åº“å­˜æœåŠ¡**ï¼šåº“å­˜ç®¡ç†ï¼Œåº“å­˜æ‰£å‡
- **æ¶ˆæ¯æœåŠ¡**ï¼šæ¶ˆæ¯æ¨é€ï¼Œé€šçŸ¥ç®¡ç†

## ğŸš€ é¡¹ç›®æ­å»º

### 1. é¡¹ç›®ç»“æ„
```
ecommerce-microservice/
â”œâ”€â”€ pom.xml (çˆ¶POM)
â”œâ”€â”€ common/ (å…¬å…±æ¨¡å—)
â”‚   â”œâ”€â”€ pom.xml
â”‚   â””â”€â”€ src/
â”œâ”€â”€ gateway/ (ç½‘å…³æœåŠ¡)
â”‚   â”œâ”€â”€ pom.xml
â”‚   â””â”€â”€ src/
â”œâ”€â”€ user-service/ (ç”¨æˆ·æœåŠ¡)
â”‚   â”œâ”€â”€ pom.xml
â”‚   â””â”€â”€ src/
â”œâ”€â”€ product-service/ (å•†å“æœåŠ¡)
â”‚   â”œâ”€â”€ pom.xml
â”‚   â””â”€â”€ src/
â”œâ”€â”€ order-service/ (è®¢å•æœåŠ¡)
â”‚   â”œâ”€â”€ pom.xml
â”‚   â””â”€â”€ src/
â”œâ”€â”€ payment-service/ (æ”¯ä»˜æœåŠ¡)
â”‚   â”œâ”€â”€ pom.xml
â”‚   â””â”€â”€ src/
â”œâ”€â”€ inventory-service/ (åº“å­˜æœåŠ¡)
â”‚   â”œâ”€â”€ pom.xml
â”‚   â””â”€â”€ src/
â””â”€â”€ message-service/ (æ¶ˆæ¯æœåŠ¡)
    â”œâ”€â”€ pom.xml
    â””â”€â”€ src/
```

### 2. çˆ¶POMé…ç½®
```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 
         http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    
    <groupId>com.example</groupId>
    <artifactId>ecommerce-microservice</artifactId>
    <version>1.0.0</version>
    <packaging>pom</packaging>
    
    <modules>
        <module>common</module>
        <module>gateway</module>
        <module>user-service</module>
        <module>product-service</module>
        <module>order-service</module>
        <module>payment-service</module>
        <module>inventory-service</module>
        <module>message-service</module>
    </modules>
    
    <properties>
        <maven.compiler.source>8</maven.compiler.source>
        <maven.compiler.target>8</maven.compiler.target>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        <spring-boot.version>2.7.14</spring-boot.version>
        <spring-cloud.version>2021.0.8</spring-cloud.version>
        <spring-cloud-alibaba.version>2021.0.5.0</spring-cloud-alibaba.version>
    </properties>
    
    <dependencyManagement>
        <dependencies>
            <!-- Spring Boot ä¾èµ–ç®¡ç† -->
            <dependency>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-dependencies</artifactId>
                <version>${spring-boot.version}</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>
            
            <!-- Spring Cloud ä¾èµ–ç®¡ç† -->
            <dependency>
                <groupId>org.springframework.cloud</groupId>
                <artifactId>spring-cloud-dependencies</artifactId>
                <version>${spring-cloud.version}</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>
            
            <!-- Spring Cloud Alibaba ä¾èµ–ç®¡ç† -->
            <dependency>
                <groupId>com.alibaba.cloud</groupId>
                <artifactId>spring-cloud-alibaba-dependencies</artifactId>
                <version>${spring-cloud-alibaba.version}</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>
        </dependencies>
    </dependencyManagement>
</project>
```

### 3. å…¬å…±æ¨¡å—
```xml
<!-- common/pom.xml -->
<dependencies>
    <!-- Spring Boot Starter -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter</artifactId>
    </dependency>
    
    <!-- Spring Boot Web Starter -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    
    <!-- Spring Boot Validation -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-validation</artifactId>
    </dependency>
    
    <!-- Lombok -->
    <dependency>
        <groupId>org.projectlombok</groupId>
        <artifactId>lombok</artifactId>
        <optional>true</optional>
    </dependency>
</dependencies>
```

## ğŸ’» æ ¸å¿ƒæœåŠ¡å®ç°

### 1. ç½‘å…³æœåŠ¡

#### ä¾èµ–é…ç½®
```xml
<!-- gateway/pom.xml -->
<dependencies>
    <!-- Spring Cloud Gateway -->
    <dependency>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-starter-gateway</artifactId>
    </dependency>
    
    <!-- NacosæœåŠ¡å‘ç° -->
    <dependency>
        <groupId>com.alibaba.cloud</groupId>
        <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
    </dependency>
    
    <!-- Spring Boot Actuator -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-actuator</artifactId>
    </dependency>
</dependencies>
```

#### é…ç½®æ–‡ä»¶
```yaml
# gateway/src/main/resources/application.yml
server:
  port: 8080

spring:
  application:
    name: gateway-service
  cloud:
    gateway:
      discovery:
        locator:
          enabled: true
          lower-case-service-id: true
      routes:
        # ç”¨æˆ·æœåŠ¡è·¯ç”±
        - id: user-service
          uri: lb://user-service
          predicates:
            - Path=/user/**
          filters:
            - StripPrefix=1
            - name: RequestRateLimiter
              args:
                redis-rate-limiter.replenishRate: 10
                redis-rate-limiter.burstCapacity: 20
                key-resolver: "#{@userKeyResolver}"
        
        # å•†å“æœåŠ¡è·¯ç”±
        - id: product-service
          uri: lb://product-service
          predicates:
            - Path=/product/**
          filters:
            - StripPrefix=1
        
        # è®¢å•æœåŠ¡è·¯ç”±
        - id: order-service
          uri: lb://order-service
          predicates:
            - Path=/order/**
          filters:
            - StripPrefix=1
        
        # æ”¯ä»˜æœåŠ¡è·¯ç”±
        - id: payment-service
          uri: lb://payment-service
          predicates:
            - Path=/payment/**
          filters:
            - StripPrefix=1

  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848
        namespace: public
        group: DEFAULT_GROUP

management:
  endpoints:
    web:
      exposure:
        include: "*"
  endpoint:
    gateway:
      enabled: true
```

#### å¯åŠ¨ç±»
```java
// gateway/src/main/java/com/example/gateway/GatewayApplication.java
package com.example.gateway;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.client.discovery.EnableDiscoveryClient;

@SpringBootApplication
@EnableDiscoveryClient
public class GatewayApplication {
    
    public static void main(String[] args) {
        SpringApplication.run(GatewayApplication.class, args);
    }
}
```

### 2. ç”¨æˆ·æœåŠ¡

#### ä¾èµ–é…ç½®
```xml
<!-- user-service/pom.xml -->
<dependencies>
    <!-- Spring Boot Web Starter -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    
    <!-- NacosæœåŠ¡å‘ç° -->
    <dependency>
        <groupId>com.alibaba.cloud</groupId>
        <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
    </dependency>
    
    <!-- Nacosé…ç½®ä¸­å¿ƒ -->
    <dependency>
        <groupId>com.alibaba.cloud</groupId>
        <artifactId>spring-cloud-starter-alibaba-nacos-config</artifactId>
    </dependency>
    
    <!-- Spring Boot Data JPA -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-data-jpa</artifactId>
    </dependency>
    
    <!-- MySQLé©±åŠ¨ -->
    <dependency>
        <groupId>mysql</groupId>
        <artifactId>mysql-connector-java</artifactId>
    </dependency>
    
    <!-- Spring Boot Actuator -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-actuator</artifactId>
    </dependency>
</dependencies>
```

#### é…ç½®æ–‡ä»¶
```yaml
# user-service/src/main/resources/bootstrap.yml
spring:
  application:
    name: user-service
  cloud:
    nacos:
      config:
        server-addr: localhost:8848
        namespace: public
        group: DEFAULT_GROUP
        file-extension: yaml
        username: nacos
        password: nacos

# user-service/src/main/resources/application.yml
server:
  port: 8081

spring:
  profiles:
    active: dev
  datasource:
    url: jdbc:mysql://localhost:3306/user_db?useUnicode=true&characterEncoding=utf8&useSSL=false
    username: root
    password: password
    driver-class-name: com.mysql.cj.jdbc.Driver
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQL8Dialect
        format_sql: true

management:
  endpoints:
    web:
      exposure:
        include: "*"
  endpoint:
    health:
      show-details: always
```

#### å®ä½“ç±»
```java
// user-service/src/main/java/com/example/userservice/entity/User.java
package com.example.userservice.entity;

import lombok.Data;
import javax.persistence.*;
import java.time.LocalDateTime;

@Data
@Entity
@Table(name = "users")
public class User {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(unique = true, nullable = false)
    private String username;
    
    @Column(nullable = false)
    private String password;
    
    @Column(unique = true)
    private String email;
    
    private String phone;
    
    private String avatar;
    
    @Enumerated(EnumType.STRING)
    private UserStatus status;
    
    private LocalDateTime createTime;
    
    private LocalDateTime updateTime;
    
    @PrePersist
    protected void onCreate() {
        createTime = LocalDateTime.now();
        updateTime = LocalDateTime.now();
    }
    
    @PreUpdate
    protected void onUpdate() {
        updateTime = LocalDateTime.now();
    }
}

public enum UserStatus {
    ACTIVE, INACTIVE, LOCKED
}
```

#### æ§åˆ¶å™¨
```java
// user-service/src/main/java/com/example/userservice/controller/UserController.java
package com.example.userservice.controller;

import com.example.userservice.entity.User;
import com.example.userservice.service.UserService;
import lombok.RequiredArgsConstructor;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequestMapping("/user")
@RequiredArgsConstructor
public class UserController {
    
    private final UserService userService;
    
    @GetMapping("/info/{id}")
    public User getUserInfo(@PathVariable Long id) {
        return userService.getUserById(id);
    }
    
    @GetMapping("/list")
    public List<User> getUserList() {
        return userService.getAllUsers();
    }
    
    @PostMapping("/create")
    public User createUser(@RequestBody User user) {
        return userService.createUser(user);
    }
    
    @PutMapping("/update/{id}")
    public User updateUser(@PathVariable Long id, @RequestBody User user) {
        return userService.updateUser(id, user);
    }
    
    @DeleteMapping("/delete/{id}")
    public void deleteUser(@PathVariable Long id) {
        userService.deleteUser(id);
    }
    
    @GetMapping("/health")
    public String health() {
        return "ç”¨æˆ·æœåŠ¡è¿è¡Œæ­£å¸¸";
    }
}
```

#### æœåŠ¡ç±»
```java
// user-service/src/main/java/com/example/userservice/service/UserService.java
package com.example.userservice.service;

import com.example.userservice.entity.User;
import com.example.userservice.repository.UserRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
@RequiredArgsConstructor
public class UserService {
    
    private final UserRepository userRepository;
    
    public User getUserById(Long id) {
        return userRepository.findById(id)
                .orElseThrow(() -> new RuntimeException("ç”¨æˆ·ä¸å­˜åœ¨"));
    }
    
    public List<User> getAllUsers() {
        return userRepository.findAll();
    }
    
    public User createUser(User user) {
        return userRepository.save(user);
    }
    
    public User updateUser(Long id, User user) {
        User existingUser = getUserById(id);
        existingUser.setUsername(user.getUsername());
        existingUser.setEmail(user.getEmail());
        existingUser.setPhone(user.getPhone());
        existingUser.setAvatar(user.getAvatar());
        existingUser.setStatus(user.getStatus());
        return userRepository.save(existingUser);
    }
    
    public void deleteUser(Long id) {
        userRepository.deleteById(id);
    }
}
```

#### å¯åŠ¨ç±»
```java
// user-service/src/main/java/com/example/userservice/UserServiceApplication.java
package com.example.userservice;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.client.discovery.EnableDiscoveryClient;

@SpringBootApplication
@EnableDiscoveryClient
public class UserServiceApplication {
    
    public static void main(String[] args) {
        SpringApplication.run(UserServiceApplication.class, args);
    }
}
```

### 3. è®¢å•æœåŠ¡

#### ä¾èµ–é…ç½®
```xml
<!-- order-service/pom.xml -->
<dependencies>
    <!-- Spring Boot Web Starter -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    
    <!-- NacosæœåŠ¡å‘ç° -->
    <dependency>
        <groupId>com.alibaba.cloud</groupId>
        <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
    </dependency>
    
    <!-- OpenFeign -->
    <dependency>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-starter-openfeign</artifactId>
    </dependency>
    
    <!-- Resilience4j -->
    <dependency>
        <groupId>io.github.resilience4j</groupId>
        <artifactId>resilience4j-spring-boot2</artifactId>
    </dependency>
    
    <!-- Spring Boot Data JPA -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-data-jpa</artifactId>
    </dependency>
    
    <!-- MySQLé©±åŠ¨ -->
    <dependency>
        <groupId>mysql</groupId>
        <artifactId>mysql-connector-java</artifactId>
    </dependency>
</dependencies>
```

#### é…ç½®æ–‡ä»¶
```yaml
# order-service/src/main/resources/application.yml
server:
  port: 8083

spring:
  application:
    name: order-service
  datasource:
    url: jdbc:mysql://localhost:3306/order_db?useUnicode=true&characterEncoding=utf8&useSSL=false
    username: root
    password: password
    driver-class-name: com.mysql.cj.jdbc.Driver
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true

# Resilience4jé…ç½®
resilience4j:
  circuitbreaker:
    instances:
      user-service:
        sliding-window-size: 10
        failure-rate-threshold: 50
        wait-duration-in-open-state: 5s
        permitted-number-of-calls-in-half-open-state: 3
        automatic-transition-from-open-to-half-open-enabled: true

# Feigné…ç½®
feign:
  client:
    config:
      default:
        connectTimeout: 5000
        readTimeout: 5000
        loggerLevel: basic

# æ—¥å¿—é…ç½®
logging:
  level:
    com.example.orderservice.client: DEBUG
```

#### Feignå®¢æˆ·ç«¯
```java
// order-service/src/main/java/com/example/orderservice/client/UserFeignClient.java
package com.example.orderservice.client;

import org.springframework.cloud.openfeign.FeignClient;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;

@FeignClient(name = "user-service")
public interface UserFeignClient {
    
    @GetMapping("/user/info/{id}")
    String getUserInfo(@PathVariable("id") Long id);
    
    @GetMapping("/user/health")
    String health();
}
```

#### è®¢å•å®ä½“
```java
// order-service/src/main/java/com/example/orderservice/entity/Order.java
package com.example.orderservice.entity;

import lombok.Data;
import javax.persistence.*;
import java.math.BigDecimal;
import java.time.LocalDateTime;
import java.util.List;

@Data
@Entity
@Table(name = "orders")
public class Order {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(unique = true, nullable = false)
    private String orderNo;
    
    private Long userId;
    
    private BigDecimal totalAmount;
    
    @Enumerated(EnumType.STRING)
    private OrderStatus status;
    
    private String address;
    
    private String phone;
    
    private String receiver;
    
    private LocalDateTime createTime;
    
    private LocalDateTime updateTime;
    
    @OneToMany(mappedBy = "order", cascade = CascadeType.ALL)
    private List<OrderItem> orderItems;
    
    @PrePersist
    protected void onCreate() {
        createTime = LocalDateTime.now();
        updateTime = LocalDateTime.now();
    }
    
    @PreUpdate
    protected void onUpdate() {
        updateTime = LocalDateTime.now();
    }
}

public enum OrderStatus {
    PENDING, PAID, SHIPPED, DELIVERED, CANCELLED
}
```

#### è®¢å•æ§åˆ¶å™¨
```java
// order-service/src/main/java/com/example/orderservice/controller/OrderController.java
package com.example.orderservice.controller;

import com.example.orderservice.entity.Order;
import com.example.orderservice.service.OrderService;
import lombok.RequiredArgsConstructor;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequestMapping("/order")
@RequiredArgsConstructor
public class OrderController {
    
    private final OrderService orderService;
    
    @GetMapping("/info/{id}")
    public Order getOrderInfo(@PathVariable Long id) {
        return orderService.getOrderById(id);
    }
    
    @GetMapping("/user/{userId}")
    public List<Order> getUserOrders(@PathVariable Long userId) {
        return orderService.getOrdersByUserId(userId);
    }
    
    @PostMapping("/create")
    public Order createOrder(@RequestBody Order order) {
        return orderService.createOrder(order);
    }
    
    @PutMapping("/status/{id}")
    public Order updateOrderStatus(@PathVariable Long id, @RequestParam String status) {
        return orderService.updateOrderStatus(id, status);
    }
    
    @GetMapping("/health")
    public String health() {
        return "è®¢å•æœåŠ¡è¿è¡Œæ­£å¸¸";
    }
}
```

#### å¯åŠ¨ç±»
```java
// order-service/src/main/java/com/example/orderservice/OrderServiceApplication.java
package com.example.orderservice;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.client.discovery.EnableDiscoveryClient;
import org.springframework.cloud.openfeign.EnableFeignClients;

@SpringBootApplication
@EnableDiscoveryClient
@EnableFeignClients
public class OrderServiceApplication {
    
    public static void main(String[] args) {
        SpringApplication.run(OrderServiceApplication.class, args);
    }
}
```

## ğŸš€ é¡¹ç›®å¯åŠ¨

### 1. ç¯å¢ƒå‡†å¤‡
```bash
# å¯åŠ¨Nacos
cd nacos
bin/startup.sh -m standalone

# å¯åŠ¨MySQL
sudo systemctl start mysql

# å¯åŠ¨Redis
sudo systemctl start redis

# å¯åŠ¨RabbitMQ
sudo systemctl start rabbitmq-server
```

### 2. æ•°æ®åº“åˆå§‹åŒ–
```sql
-- åˆ›å»ºç”¨æˆ·æ•°æ®åº“
CREATE DATABASE user_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- åˆ›å»ºè®¢å•æ•°æ®åº“
CREATE DATABASE order_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- åˆ›å»ºå•†å“æ•°æ®åº“
CREATE DATABASE product_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 3. æœåŠ¡å¯åŠ¨é¡ºåº
```bash
# 1. å¯åŠ¨ç½‘å…³æœåŠ¡
cd gateway
mvn spring-boot:run

# 2. å¯åŠ¨ç”¨æˆ·æœåŠ¡
cd user-service
mvn spring-boot:run

# 3. å¯åŠ¨å•†å“æœåŠ¡
cd product-service
mvn spring-boot:run

# 4. å¯åŠ¨è®¢å•æœåŠ¡
cd order-service
mvn spring-boot:run

# 5. å¯åŠ¨å…¶ä»–æœåŠ¡
cd payment-service
mvn spring-boot:run

cd inventory-service
mvn spring-boot:run

cd message-service
mvn spring-boot:run
```

## ğŸ§ª åŠŸèƒ½æµ‹è¯•

### 1. æœåŠ¡æ³¨å†Œæµ‹è¯•
```bash
# è®¿é—®Nacosæ§åˆ¶å°
http://localhost:8848/nacos
# ç”¨æˆ·å/å¯†ç ï¼šnacos/nacos

# æŸ¥çœ‹æœåŠ¡åˆ—è¡¨
curl http://localhost:8848/nacos/v1/ns/service/list
```

### 2. ç½‘å…³è·¯ç”±æµ‹è¯•
```bash
# é€šè¿‡ç½‘å…³è®¿é—®ç”¨æˆ·æœåŠ¡
curl http://localhost:8080/user/health

# é€šè¿‡ç½‘å…³è®¿é—®è®¢å•æœåŠ¡
curl http://localhost:8080/order/health

# é€šè¿‡ç½‘å…³è®¿é—®å•†å“æœåŠ¡
curl http://localhost:8080/product/health
```

### 3. æœåŠ¡è°ƒç”¨æµ‹è¯•
```bash
# åˆ›å»ºç”¨æˆ·
curl -X POST http://localhost:8080/user/create \
  -H "Content-Type: application/json" \
  -d '{"username":"test","password":"123456","email":"test@example.com"}'

# åˆ›å»ºè®¢å•
curl -X POST http://localhost:8080/order/create \
  -H "Content-Type: application/json" \
  -d '{"userId":1,"totalAmount":99.99,"status":"PENDING"}'

# æŸ¥è¯¢è®¢å•
curl http://localhost:8080/order/info/1
```

## ğŸ“Š ç›‘æ§å’Œè¿ç»´

### 1. å¥åº·æ£€æŸ¥
```bash
# ç½‘å…³å¥åº·æ£€æŸ¥
curl http://localhost:8080/actuator/health

# ç”¨æˆ·æœåŠ¡å¥åº·æ£€æŸ¥
curl http://localhost:8081/actuator/health

# è®¢å•æœåŠ¡å¥åº·æ£€æŸ¥
curl http://localhost:8083/actuator/health
```

### 2. æ€§èƒ½ç›‘æ§
```bash
# æŸ¥çœ‹æŒ‡æ ‡
curl http://localhost:8080/actuator/metrics

# æŸ¥çœ‹JVMæŒ‡æ ‡
curl http://localhost:8080/actuator/metrics/jvm.memory.used

# æŸ¥çœ‹HTTPæŒ‡æ ‡
curl http://localhost:8080/actuator/metrics/http.server.requests
```

### 3. æ—¥å¿—æŸ¥çœ‹
```bash
# æŸ¥çœ‹ç½‘å…³æ—¥å¿—
tail -f gateway/logs/gateway.log

# æŸ¥çœ‹ç”¨æˆ·æœåŠ¡æ—¥å¿—
tail -f user-service/logs/user-service.log

# æŸ¥çœ‹è®¢å•æœåŠ¡æ—¥å¿—
tail -f order-service/logs/order-service.log
```

## ğŸš¨ æ•…éšœæ’æŸ¥

### 1. æœåŠ¡æ— æ³•æ³¨å†Œ
**æ’æŸ¥æ­¥éª¤ï¼š**
1. æ£€æŸ¥NacosæœåŠ¡çŠ¶æ€
2. æ£€æŸ¥ç½‘ç»œè¿æ¥
3. æ£€æŸ¥é…ç½®æ–‡ä»¶
4. æŸ¥çœ‹åº”ç”¨æ—¥å¿—

### 2. æœåŠ¡è°ƒç”¨å¤±è´¥
**æ’æŸ¥æ­¥éª¤ï¼š**
1. æ£€æŸ¥æœåŠ¡æ³¨å†ŒçŠ¶æ€
2. æ£€æŸ¥ç½‘ç»œè¿æ¥
3. æ£€æŸ¥ç†”æ–­å™¨çŠ¶æ€
4. æŸ¥çœ‹è°ƒç”¨æ—¥å¿—

### 3. é…ç½®æ— æ³•åˆ·æ–°
**æ’æŸ¥æ­¥éª¤ï¼š**
1. æ£€æŸ¥@RefreshScopeæ³¨è§£
2. æ£€æŸ¥é…ç½®æ¨é€æœºåˆ¶
3. æ‰‹åŠ¨åˆ·æ–°é…ç½®
4. æŸ¥çœ‹é…ç½®ä¸­å¿ƒæ—¥å¿—

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. æœåŠ¡è®¾è®¡åŸåˆ™
- **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªæœåŠ¡ä¸“æ³¨ä¸€ä¸ªä¸šåŠ¡åŠŸèƒ½
- **é«˜å†…èšä½è€¦åˆ**ï¼šæœåŠ¡å†…éƒ¨é«˜å†…èšï¼ŒæœåŠ¡é—´ä½è€¦åˆ
- **æœåŠ¡è‡ªæ²»**ï¼šæœåŠ¡ç‹¬ç«‹å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²

### 2. é…ç½®ç®¡ç†
- **ç¯å¢ƒéš”ç¦»**ï¼šä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒé…ç½®
- **é…ç½®åŠ å¯†**ï¼šæ•æ„Ÿä¿¡æ¯åŠ å¯†å­˜å‚¨
- **ç‰ˆæœ¬ç®¡ç†**ï¼šé…ç½®å˜æ›´ç‰ˆæœ¬æ§åˆ¶

### 3. ç›‘æ§å‘Šè­¦
- **å¥åº·æ£€æŸ¥**ï¼šå®šæœŸæ£€æŸ¥æœåŠ¡çŠ¶æ€
- **æ€§èƒ½ç›‘æ§**ï¼šç›‘æ§å…³é”®æ€§èƒ½æŒ‡æ ‡
- **æ—¥å¿—è¿½è¸ª**ï¼šè®°å½•å®Œæ•´çš„è¯·æ±‚é“¾è·¯

## ğŸ”— æ‰©å±•åŠŸèƒ½

### 1. å®‰å…¨è®¤è¯
- JWT Tokenè®¤è¯
- OAuth2æˆæƒ
- RBACæƒé™æ§åˆ¶

### 2. ç¼“å­˜ç­–ç•¥
- Redisç¼“å­˜
- æœ¬åœ°ç¼“å­˜
- ç¼“å­˜æ›´æ–°ç­–ç•¥

### 3. æ¶ˆæ¯é˜Ÿåˆ—
- å¼‚æ­¥å¤„ç†
- å‰Šå³°å¡«è°·
- æ¶ˆæ¯å¯é æ€§

### 4. åˆ†å¸ƒå¼äº‹åŠ¡
- Seataé›†æˆ
- TCCæ¨¡å¼
- Sagaæ¨¡å¼

---

**è®°ä½ï¼šå®è·µæ˜¯æœ€å¥½çš„å­¦ä¹ æ–¹å¼ï¼ŒåŠ¨æ‰‹æ­å»ºé¡¹ç›®æ‰èƒ½çœŸæ­£æŒæ¡å¾®æœåŠ¡ï¼** ğŸ¯
