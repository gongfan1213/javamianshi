# ZooKeeper é¢è¯•é¢˜é›†é”¦

## ğŸ¯ åŸºç¡€æ¦‚å¿µç±»

### 1. ä»€ä¹ˆæ˜¯ZooKeeperï¼Ÿå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ

**ç­”æ¡ˆï¼š**
ZooKeeperæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼åè°ƒæœåŠ¡ï¼Œä¸»è¦ç”¨äºè§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„åè°ƒé—®é¢˜ã€‚

**ä¸»è¦ä½œç”¨ï¼š**
- **é…ç½®ç®¡ç†**ï¼šé›†ä¸­ç®¡ç†åˆ†å¸ƒå¼ç³»ç»Ÿçš„é…ç½®ä¿¡æ¯
- **å‘½åæœåŠ¡**ï¼šæä¾›åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å‘½åæœåŠ¡
- **åˆ†å¸ƒå¼é”**ï¼šå®ç°åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„äº’æ–¥è®¿é—®
- **é›†ç¾¤ç®¡ç†**ï¼šç›‘æ§é›†ç¾¤èŠ‚ç‚¹çŠ¶æ€ï¼Œå®ç°æ•…éšœæ£€æµ‹
- **æœåŠ¡å‘ç°**ï¼šå®ç°æœåŠ¡çš„æ³¨å†Œä¸å‘ç°

**æ ¸å¿ƒç‰¹æ€§ï¼š**
- å¼ºä¸€è‡´æ€§ä¿è¯
- é«˜å¯ç”¨æ€§
- å®æ—¶é€šçŸ¥æœºåˆ¶
- ç®€å•çš„APIæ¥å£

### 2. ZooKeeperçš„æ•°æ®æ¨¡å‹æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ

**ç­”æ¡ˆï¼š**
ZooKeeperé‡‡ç”¨ç±»ä¼¼æ–‡ä»¶ç³»ç»Ÿçš„å±‚æ¬¡å‘½åç©ºé—´ç»“æ„ï¼š

```
/
â”œâ”€â”€ app1/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ database.properties
â”‚   â”‚   â””â”€â”€ redis.properties
â”‚   â””â”€â”€ services/
â”‚       â””â”€â”€ user-service
â”œâ”€â”€ app2/
â”‚   â””â”€â”€ config/
â””â”€â”€ global/
    â””â”€â”€ system-status
```

**ç‰¹ç‚¹ï¼š**
- æ¯ä¸ªèŠ‚ç‚¹ç§°ä¸ºZNode
- æ”¯æŒå±‚æ¬¡åŒ–è·¯å¾„
- èŠ‚ç‚¹å¯ä»¥å­˜å‚¨æ•°æ®ï¼ˆæœ€å¤§1MBï¼‰
- æ”¯æŒå¤šç§èŠ‚ç‚¹ç±»å‹

### 3. ZooKeeperä¸­çš„ZNodeæœ‰å“ªäº›ç±»å‹ï¼Ÿ

**ç­”æ¡ˆï¼š**
ZooKeeperæ”¯æŒå››ç§ZNodeç±»å‹ï¼š

1. **æŒä¹…èŠ‚ç‚¹ï¼ˆPersistentï¼‰**
   - åˆ›å»ºåæ°¸ä¹…å­˜åœ¨
   - é™¤éæ‰‹åŠ¨åˆ é™¤
   - é€‚åˆå­˜å‚¨é…ç½®ä¿¡æ¯

2. **ä¸´æ—¶èŠ‚ç‚¹ï¼ˆEphemeralï¼‰**
   - ä¼šè¯ç»“æŸæ—¶è‡ªåŠ¨åˆ é™¤
   - é€‚åˆæœåŠ¡æ³¨å†Œ
   - ç”¨äºæ•…éšœæ£€æµ‹

3. **é¡ºåºèŠ‚ç‚¹ï¼ˆSequentialï¼‰**
   - è‡ªåŠ¨æ·»åŠ é€’å¢åºå·
   - ä¿è¯åˆ›å»ºé¡ºåº
   - é€‚åˆå®ç°åˆ†å¸ƒå¼é”

4. **ä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼ˆEphemeral Sequentialï¼‰**
   - ä¸´æ—¶èŠ‚ç‚¹ + é¡ºåºèŠ‚ç‚¹
   - ä¼šè¯ç»“æŸæ—¶è‡ªåŠ¨åˆ é™¤
   - é€‚åˆå®ç°å…¬å¹³çš„åˆ†å¸ƒå¼é”

## ğŸ—ï¸ æ¶æ„è®¾è®¡ç±»

### 4. ZooKeeperçš„æ¶æ„æ˜¯æ€æ ·çš„ï¼Ÿæœ‰å“ªäº›è§’è‰²ï¼Ÿ

**ç­”æ¡ˆï¼š**
ZooKeeperé‡‡ç”¨ä¸»ä»æ¶æ„ï¼ŒåŒ…å«ä¸‰ç§è§’è‰²ï¼š

1. **Leaderï¼ˆé¢†å¯¼è€…ï¼‰**
   - å¤„ç†æ‰€æœ‰å†™è¯·æ±‚
   - åè°ƒé›†ç¾¤
   - é›†ç¾¤ä¸­åªæœ‰ä¸€ä¸ªLeader
   - é€šè¿‡ZABåè®®é€‰ä¸¾äº§ç”Ÿ

2. **Followerï¼ˆè·Ÿéšè€…ï¼‰**
   - å¤„ç†è¯»è¯·æ±‚
   - å‚ä¸Leaderé€‰ä¸¾
   - å¯ä»¥æœ‰å¤šä¸ª
   - ä¸èƒ½å¤„ç†å†™è¯·æ±‚

3. **Observerï¼ˆè§‚å¯Ÿè€…ï¼‰**
   - åªå¤„ç†è¯»è¯·æ±‚
   - ä¸å‚ä¸é€‰ä¸¾
   - æé«˜è¯»æ€§èƒ½
   - ä¸å½±å“å†™æ€§èƒ½

**æ¶æ„ç‰¹ç‚¹ï¼š**
- å†™è¯·æ±‚å¿…é¡»ç»è¿‡Leader
- è¯»è¯·æ±‚å¯ä»¥ä»»æ„èŠ‚ç‚¹å¤„ç†
- æ”¯æŒé›†ç¾¤éƒ¨ç½²
- å…·å¤‡æ•…éšœæ¢å¤èƒ½åŠ›

### 5. ä»€ä¹ˆæ˜¯ZABåè®®ï¼Ÿå®ƒåŒ…å«å“ªäº›é˜¶æ®µï¼Ÿ

**ç­”æ¡ˆï¼š**
ZABï¼ˆZooKeeper Atomic Broadcastï¼‰æ˜¯ZooKeeperçš„æ ¸å¿ƒåè®®ï¼Œç”¨äºä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚

**åŒ…å«ä¸¤ä¸ªé˜¶æ®µï¼š**

1. **Leaderé€‰ä¸¾ï¼ˆLeader Electionï¼‰**
   - æ¯ä¸ªèŠ‚ç‚¹å‘èµ·æŠ•ç¥¨è¯·æ±‚
   - èŠ‚ç‚¹æŠ•ç¥¨ç»™æ¯”è‡ªå·±IDå¤§çš„èŠ‚ç‚¹
   - ç»Ÿè®¡æŠ•ç¥¨ç»“æœï¼Œå¾—ç¥¨è¿‡åŠçš„æˆä¸ºLeader
   - å…¶ä»–èŠ‚ç‚¹æˆä¸ºFollower

2. **åŸå­å¹¿æ’­ï¼ˆAtomic Broadcastï¼‰**
   - Client â†’ Leader â†’ ææ¡ˆ(Proposal) â†’ Follower â†’ ç¡®è®¤(Ack)
   - Leader â†’ æäº¤(Commit) â†’ Follower
   - Client â† å“åº”ç»“æœ

**ç‰¹ç‚¹ï¼š**
- ä¿è¯å…¨å±€é¡ºåºæ€§
- æ”¯æŒæ•…éšœæ¢å¤
- å¼ºä¸€è‡´æ€§ä¿è¯

### 6. ä¸ºä»€ä¹ˆZooKeeperé›†ç¾¤å»ºè®®ä½¿ç”¨å¥‡æ•°ä¸ªèŠ‚ç‚¹ï¼Ÿ

**ç­”æ¡ˆï¼š**
ä½¿ç”¨å¥‡æ•°ä¸ªèŠ‚ç‚¹ä¸»è¦æœ‰ä»¥ä¸‹åŸå› ï¼š

1. **é¿å…è„‘è£‚é—®é¢˜**
   - å¶æ•°èŠ‚ç‚¹å¯èƒ½å¯¼è‡´é€‰ä¸¾åƒµå±€
   - å¥‡æ•°èŠ‚ç‚¹æ›´å®¹æ˜“è¾¾æˆå¤šæ•°å…±è¯†

2. **èµ„æºåˆ©ç”¨ç‡**
   - 3èŠ‚ç‚¹é›†ç¾¤ï¼šæœ€å¤šå®¹å¿1ä¸ªèŠ‚ç‚¹æ•…éšœ
   - 4èŠ‚ç‚¹é›†ç¾¤ï¼šæœ€å¤šå®¹å¿1ä¸ªèŠ‚ç‚¹æ•…éšœ
   - 5èŠ‚ç‚¹é›†ç¾¤ï¼šæœ€å¤šå®¹å¿2ä¸ªèŠ‚ç‚¹æ•…éšœ

3. **é€‰ä¸¾æ•ˆç‡**
   - å¥‡æ•°èŠ‚ç‚¹é€‰ä¸¾æ›´å¿«
   - å‡å°‘é€‰ä¸¾å†²çª

**æ¨èé…ç½®ï¼š**
- å¼€å‘ç¯å¢ƒï¼š3èŠ‚ç‚¹
- æµ‹è¯•ç¯å¢ƒï¼š3-5èŠ‚ç‚¹
- ç”Ÿäº§ç¯å¢ƒï¼š5-7èŠ‚ç‚¹

## ğŸ”§ æ ¸å¿ƒç‰¹æ€§ç±»

### 7. ZooKeeperå¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Ÿ

**ç­”æ¡ˆï¼š**
ZooKeeperé€šè¿‡ä»¥ä¸‹æœºåˆ¶ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼š

1. **é¡ºåºä¸€è‡´æ€§ï¼ˆSequential Consistencyï¼‰**
   - å…¨å±€å•è°ƒé€’å¢çš„äº‹åŠ¡IDï¼ˆzxidï¼‰
   - æ‰€æœ‰å†™æ“ä½œæŒ‰é¡ºåºæ‰§è¡Œ
   - è¯»æ“ä½œèƒ½çœ‹åˆ°ä¹‹å‰æ‰€æœ‰å†™æ“ä½œçš„ç»“æœ

2. **åŸå­æ€§ï¼ˆAtomicityï¼‰**
   - äº‹åŠ¡è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥
   - ä¸å­˜åœ¨éƒ¨åˆ†æˆåŠŸçš„æƒ…å†µ

3. **å•ä¸€ç³»ç»Ÿæ˜ åƒï¼ˆSingle System Imageï¼‰**
   - å®¢æˆ·ç«¯è¿æ¥åˆ°ä»»æ„èŠ‚ç‚¹çœ‹åˆ°çš„æ•°æ®ä¸€è‡´
   - å¼ºä¸€è‡´æ€§ä¿è¯

4. **ZABåè®®**
   - ä¿è¯Leaderé€‰ä¸¾çš„ä¸€è‡´æ€§
   - ä¿è¯æ•°æ®å¹¿æ’­çš„é¡ºåºæ€§

### 8. ZooKeeperçš„Watcheræœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ

**ç­”æ¡ˆï¼š**
Watcheræ˜¯ZooKeeperçš„ç›‘å¬æœºåˆ¶ï¼Œç”¨äºç›‘å¬èŠ‚ç‚¹å˜åŒ–ã€‚

**ç‰¹ç‚¹ï¼š**

1. **ä¸€æ¬¡æ€§ç›‘å¬å™¨**
   - è§¦å‘åè‡ªåŠ¨å¤±æ•ˆ
   - éœ€è¦æ‰‹åŠ¨é‡æ–°æ³¨å†Œ

2. **ç›‘å¬ç±»å‹**
   - èŠ‚ç‚¹æ•°æ®å˜åŒ–
   - å­èŠ‚ç‚¹å˜åŒ–
   - èŠ‚ç‚¹åˆ›å»º/åˆ é™¤

3. **ä½¿ç”¨æ–¹å¼**
   ```java
   // ç›‘å¬èŠ‚ç‚¹æ•°æ®å˜åŒ–
   zk.getData("/app/config", dataWatcher, null);
   
   // ç›‘å¬å­èŠ‚ç‚¹å˜åŒ–
   zk.getChildren("/app", childrenWatcher);
   
   // ç›‘å¬èŠ‚ç‚¹å­˜åœ¨æ€§
   zk.exists("/app/new-node", existsWatcher);
   ```

**æ³¨æ„äº‹é¡¹ï¼š**
- ç›‘å¬å™¨è§¦å‘åéœ€è¦é‡æ–°æ³¨å†Œ
- é¿å…ç›‘å¬è¿‡å¤šèŠ‚ç‚¹
- å¤„ç†ç½‘ç»œå¼‚å¸¸æƒ…å†µ

## ğŸ’» Javaå®¢æˆ·ç«¯ç±»

### 9. å¦‚ä½•åœ¨Javaä¸­è¿æ¥ZooKeeperï¼Ÿ

**ç­”æ¡ˆï¼š**
```java
import org.apache.zookeeper.*;
import java.util.concurrent.CountDownLatch;

public class ZooKeeperClient {
    private ZooKeeper zk;
    private CountDownLatch connectedSignal = new CountDownLatch(1);
    
    public void connect(String connectString) throws Exception {
        // åˆ›å»ºè¿æ¥
        zk = new ZooKeeper(connectString, 5000, new Watcher() {
            @Override
            public void process(WatchedEvent event) {
                if (event.getState() == Event.KeeperState.SyncConnected) {
                    connectedSignal.countDown();
                    System.out.println("è¿æ¥æˆåŠŸï¼");
                }
            }
        });
        
        // ç­‰å¾…è¿æ¥å»ºç«‹
        connectedSignal.await();
    }
    
    public void close() throws InterruptedException {
        if (zk != null) {
            zk.close();
        }
    }
}
```

**è¿æ¥å‚æ•°è¯´æ˜ï¼š**
- `connectString`ï¼šZooKeeperæœåŠ¡å™¨åœ°å€
- `sessionTimeout`ï¼šä¼šè¯è¶…æ—¶æ—¶é—´
- `watcher`ï¼šè¿æ¥çŠ¶æ€ç›‘å¬å™¨

### 10. å¦‚ä½•å®ç°åŸºäºZooKeeperçš„åˆ†å¸ƒå¼é”ï¼Ÿ

**ç­”æ¡ˆï¼š**
```java
public class DistributedLock {
    private ZooKeeper zk;
    private String lockPath;
    private String lockNode;
    private boolean isLocked = false;
    
    public DistributedLock(ZooKeeper zk, String lockPath) {
        this.zk = zk;
        this.lockPath = lockPath;
    }
    
    // è·å–é”
    public boolean acquireLock(long timeout) throws Exception {
        try {
            // åˆ›å»ºä¸´æ—¶é¡ºåºèŠ‚ç‚¹
            lockNode = zk.create(lockPath + "/lock-", "locked".getBytes(),
                               ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL_SEQUENTIAL);
            
            // æ£€æŸ¥æ˜¯å¦è·å¾—é”
            if (checkLockAcquired(lockNode)) {
                isLocked = true;
                return true;
            }
            
            // ç­‰å¾…é”é‡Šæ”¾
            return waitForLock(lockNode, timeout);
            
        } catch (Exception e) {
            e.printStackTrace();
        }
        
        return false;
    }
    
    // æ£€æŸ¥æ˜¯å¦è·å¾—é”
    private boolean checkLockAcquired(String lockNode) throws Exception {
        List<String> children = zk.getChildren(lockPath, false);
        Collections.sort(children);
        
        String nodeName = lockNode.substring(lockNode.lastIndexOf("/") + 1);
        return children.get(0).equals(nodeName);
    }
    
    // é‡Šæ”¾é”
    public void releaseLock() throws Exception {
        if (isLocked && lockNode != null) {
            zk.delete(lockNode, -1);
            isLocked = false;
            lockNode = null;
        }
    }
}
```

**å®ç°åŸç†ï¼š**
- ä½¿ç”¨ä¸´æ—¶é¡ºåºèŠ‚ç‚¹
- åºå·æœ€å°çš„èŠ‚ç‚¹è·å¾—é”
- ç›‘å¬å‰ä¸€ä¸ªèŠ‚ç‚¹çš„åˆ é™¤äº‹ä»¶
- ä¼šè¯ç»“æŸæ—¶è‡ªåŠ¨é‡Šæ”¾é”

## ğŸš€ é«˜çº§åº”ç”¨ç±»

### 11. å¦‚ä½•å®ç°åŸºäºZooKeeperçš„é…ç½®ä¸­å¿ƒï¼Ÿ

**ç­”æ¡ˆï¼š**
```java
public class ConfigurationManager {
    private ZooKeeper zk;
    private String configRootPath;
    private Map<String, String> localCache = new ConcurrentHashMap<>();
    
    public ConfigurationManager(ZooKeeper zk, String configRootPath) {
        this.zk = zk;
        this.configRootPath = configRootPath;
    }
    
    // è®¾ç½®é…ç½®
    public void setConfig(String appName, String configName, String value) throws Exception {
        String path = configRootPath + "/" + appName + "/" + configName;
        
        if (zk.exists(path, false) == null) {
            zk.create(path, value.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);
        } else {
            zk.setData(path, value.getBytes(), -1);
        }
        
        localCache.put(path, value);
    }
    
    // è·å–é…ç½®
    public String getConfig(String appName, String configName) throws Exception {
        String path = configRootPath + "/" + appName + "/" + configName;
        
        // å…ˆä»æœ¬åœ°ç¼“å­˜è·å–
        String cachedValue = localCache.get(path);
        if (cachedValue != null) {
            return cachedValue;
        }
        
        // ä»ZooKeeperè·å–
        byte[] data = zk.getData(path, false, null);
        String value = new String(data);
        
        // æ›´æ–°æœ¬åœ°ç¼“å­˜
        localCache.put(path, value);
        
        // æ³¨å†Œç›‘å¬å™¨
        registerWatcher(path);
        
        return value;
    }
}
```

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- é…ç½®çš„å¢åˆ æ”¹æŸ¥
- æœ¬åœ°ç¼“å­˜ä¼˜åŒ–
- é…ç½®å˜åŒ–ç›‘å¬
- å®æ—¶é€šçŸ¥æœºåˆ¶

### 12. å¦‚ä½•å®ç°åŸºäºZooKeeperçš„æœåŠ¡å‘ç°ï¼Ÿ

**ç­”æ¡ˆï¼š**
```java
public class ServiceRegistry {
    private ZooKeeper zk;
    private String serviceRootPath;
    private String serviceName;
    private String instancePath;
    
    public ServiceRegistry(ZooKeeper zk, String serviceRootPath, String serviceName) {
        this.zk = zk;
        this.serviceRootPath = serviceRootPath;
        this.serviceName = serviceName;
    }
    
    // æ³¨å†ŒæœåŠ¡
    public void registerService(String host, int port, Map<String, String> metadata) throws Exception {
        String servicePath = serviceRootPath + "/" + serviceName;
        
        // ç¡®ä¿æœåŠ¡ç›®å½•å­˜åœ¨
        if (zk.exists(servicePath, false) == null) {
            zk.create(servicePath, "service".getBytes(),
                      ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);
        }
        
        // åˆ›å»ºæœåŠ¡å®ä¾‹èŠ‚ç‚¹
        String instancePath = servicePath + "/" + UUID.randomUUID().toString();
        
        // æ„å»ºå®ä¾‹ä¿¡æ¯
        ServiceInstance instance = new ServiceInstance();
        instance.setHost(host);
        instance.setPort(port);
        instance.setStatus("UP");
        instance.setMetadata(metadata);
        
        // åºåˆ—åŒ–å®ä¾‹ä¿¡æ¯
        String instanceData = serializeInstance(instance);
        
        // åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹ï¼Œä¼šè¯ç»“æŸæ—¶è‡ªåŠ¨åˆ é™¤
        this.instancePath = zk.create(instancePath, instanceData.getBytes(),
                                     ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL);
    }
}
```

**æ ¸å¿ƒç‰¹æ€§ï¼š**
- æœåŠ¡è‡ªåŠ¨æ³¨å†Œ
- æœåŠ¡è‡ªåŠ¨å‘ç°
- å¥åº·çŠ¶æ€ç›‘æ§
- è´Ÿè½½å‡è¡¡æ”¯æŒ

## ğŸ” æ•…éšœæ’æŸ¥ç±»

### 13. ZooKeeperé›†ç¾¤æ— æ³•å¯åŠ¨æ€ä¹ˆåŠï¼Ÿ

**ç­”æ¡ˆï¼š**
ZooKeeperé›†ç¾¤æ— æ³•å¯åŠ¨çš„æ’æŸ¥æ­¥éª¤ï¼š

1. **æ£€æŸ¥è¿›ç¨‹çŠ¶æ€**
   ```bash
   ps aux | grep zookeeper
   ```

2. **æ£€æŸ¥ç«¯å£ç›‘å¬**
   ```bash
   netstat -tlnp | grep :2181
   ```

3. **æ£€æŸ¥æ—¥å¿—**
   ```bash
   tail -f /opt/zookeeper/logs/zookeeper.out
   ```

4. **æ£€æŸ¥æ•°æ®ç›®å½•**
   ```bash
   ls -la /opt/zookeeper/data/
   ```

5. **æ£€æŸ¥é…ç½®æ–‡ä»¶**
   ```bash
   cat /opt/zookeeper/conf/zoo.cfg
   ```

6. **æ£€æŸ¥èŠ‚ç‚¹IDé…ç½®**
   ```bash
   cat /opt/zookeeper/data/myid
   ```

**å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆï¼š**

1. **ç«¯å£è¢«å ç”¨**
   ```bash
   # æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
   lsof -i :2181
   
   # æ€æ­»è¿›ç¨‹
   kill -9 <PID>
   ```

2. **æ•°æ®ç›®å½•æƒé™é—®é¢˜**
   ```bash
   # æ£€æŸ¥æƒé™
   ls -la /opt/zookeeper/data/
   
   # ä¿®æ”¹æƒé™
   chown -R zookeeper:zookeeper /opt/zookeeper/data/
   chmod 755 /opt/zookeeper/data/
   ```

### 14. ZooKeeperå‡ºç°è„‘è£‚é—®é¢˜æ€ä¹ˆåŠï¼Ÿ

**ç­”æ¡ˆï¼š**
è„‘è£‚é—®é¢˜çš„é¢„é˜²å’Œè§£å†³æ–¹æ¡ˆï¼š

1. **é¢„é˜²æªæ–½**
   - ä½¿ç”¨å¥‡æ•°ä¸ªèŠ‚ç‚¹
   - åˆç†è®¾ç½®è¶…æ—¶å‚æ•°
   - ä½¿ç”¨ä¸“ç”¨ç½‘ç»œ
   - é…ç½®é˜²ç«å¢™è§„åˆ™

2. **è¶…æ—¶å‚æ•°é…ç½®**
   ```properties
   # åŸºæœ¬é…ç½®
   tickTime=2000
   initLimit=10
   syncLimit=5
   
   # ä¼šè¯è¶…æ—¶
   sessionTimeout=5000
   
   # è¿æ¥è¶…æ—¶
   connectionTimeout=10000
   ```

3. **ç½‘ç»œéš”ç¦»**
   ```bash
   # ä½¿ç”¨ä¸“ç”¨ç½‘ç»œ
   # é…ç½®é˜²ç«å¢™
   iptables -A INPUT -p tcp --dport 2181 -s <zk-cluster-ip> -j ACCEPT
   iptables -A INPUT -p tcp --dport 2181 -j DROP
   ```

## ğŸ’¡ æœ€ä½³å®è·µç±»

### 15. ZooKeeperåœ¨ç”Ÿäº§ç¯å¢ƒä¸­çš„æœ€ä½³å®è·µæœ‰å“ªäº›ï¼Ÿ

**ç­”æ¡ˆï¼š**
ç”Ÿäº§ç¯å¢ƒçš„æœ€ä½³å®è·µï¼š

1. **é›†ç¾¤é…ç½®**
   - ä½¿ç”¨å¥‡æ•°ä¸ªèŠ‚ç‚¹ï¼ˆæ¨è5-7ä¸ªï¼‰
   - éƒ¨ç½²åœ¨ä¸åŒæœºæ¶æˆ–æœºæˆ¿
   - ä½¿ç”¨ä¸“ç”¨ç½‘ç»œ
   - é…ç½®ç›‘æ§å’Œå‘Šè­¦

2. **æ€§èƒ½ä¼˜åŒ–**
   ```properties
   # JVMå‚æ•°ä¼˜åŒ–
   export SERVER_JVMFLAGS="-Xms4g -Xmx4g -XX:+UseG1GC -XX:MaxGCPauseMillis=200"
   
   # ç³»ç»Ÿå‚æ•°ä¼˜åŒ–
   echo 'vm.dirty_ratio = 15' >> /etc/sysctl.conf
   echo 'vm.dirty_background_ratio = 5' >> /etc/sysctl.conf
   ```

3. **å®‰å…¨é…ç½®**
   ```properties
   # å¯ç”¨ACL
   # é…ç½®è®¤è¯
   # ç½‘ç»œéš”ç¦»
   # å®¡è®¡æ—¥å¿—
   ```

4. **ç›‘æ§å‘Šè­¦**
   - ç›‘æ§è¿æ¥æ•°
   - ç›‘æ§å“åº”æ—¶é—´
   - ç›‘æ§å†…å­˜ä½¿ç”¨
   - ç›‘æ§ç£ç›˜ä½¿ç”¨
   - é…ç½®å‘Šè­¦é˜ˆå€¼

5. **å¤‡ä»½ç­–ç•¥**
   - å®šæœŸå¤‡ä»½æ•°æ®ç›®å½•
   - å¤‡ä»½é…ç½®æ–‡ä»¶
   - æµ‹è¯•æ¢å¤æµç¨‹
   - æ–‡æ¡£åŒ–æ“ä½œæµç¨‹

## ğŸ”— æ€»ç»“

æŒæ¡è¿™äº›é¢è¯•é¢˜ï¼Œä½ å°±èƒ½åœ¨ZooKeeperç›¸å…³çš„é¢è¯•ä¸­æ¸¸åˆƒæœ‰ä½™ï¼è®°ä½ï¼š

1. **ç†è§£åŸç†**ï¼šæ·±å…¥ç†è§£ZABåè®®ã€æ•°æ®æ¨¡å‹ç­‰æ ¸å¿ƒæ¦‚å¿µ
2. **æŒæ¡å®è·µ**ï¼šç†Ÿç»ƒä½¿ç”¨Javaå®¢æˆ·ç«¯APIï¼Œå®ç°å„ç§åˆ†å¸ƒå¼åŠŸèƒ½
3. **å…³æ³¨æ€§èƒ½**ï¼šäº†è§£æ€§èƒ½ä¼˜åŒ–å’Œç›‘æ§æ–¹æ³•
4. **é‡è§†è¿ç»´**ï¼šæŒæ¡æ•…éšœæ’æŸ¥å’Œæœ€ä½³å®è·µ

**ç¥ä½ é¢è¯•æˆåŠŸï¼** ğŸ¯
