### 依赖与框架选型对比（blueplan-research-dev-langgraph2 vs prod/blueplan-research）

#### 结论速览
- **dev 使用 LangGraph+LangChain 套件**：显式引入 `langgraph` 全家桶（`langgraph`, `langgraph-checkpoint*`, `prebuilt`, `sdk`），并配合 `@tool` + `create_react_agent` 统一工具注入；新增基于 `StateGraph` 的工作流编排与恢复能力。
- **prod 主要依赖 LangChain + LangSmith**：没有在 requirements 中引入 `langgraph`，方案以 Nova3/Loomi 的传统流程为主，观测用 LangSmith。
- **可观测平台迁移**：dev 将可观测性从 LangSmith 迁移为开源的 Langfuse（requirements 与日志均可佐证）。

#### 关键证据
- dev 依赖文件：`blueplan-research-dev-langgraph2/requirements.txt`
  - 含 `langgraph==0.3.5`、`langgraph-prebuilt==0.1.8`、`langgraph-checkpoint[-redis]` 等；
  - LangChain 相关：`langchain`, `langchain-core`, `langchain-community`, `langchain-openai` 等；
  - 可观测：`langfuse>=2.0.0`（并注释“替代 LangSmith”）。
- prod 依赖文件：`prod/blueplan-research/requirements.txt`
  - 有 `langchain` 与 `langsmith>=0.1.0`；
  - 未显式包含 `langgraph`。
- 可观测取证：
  - dev 日志与 env 存在 `Langfuse` 相关配置与输出（如 `env.dev` 的 `LANGFUSE_HOST`，日志“Langfuse追踪已启用”）。
  - prod 存在 `utils/langsmith_llm_client*.py` 与数据/日志中大量 `langsmith_run_id`、`langsmith_master_run_id`。

#### 框架能力差异
- **LangGraph 引入后（dev）**：
  - DAG 编排：`StateGraph` 明确节点与边（`add_node/add_edge/add_conditional_edges`）。
  - 人审与恢复：基于 `interrupt/resume` 与检查点（Memory/Redis）。
  - 工具注入：`@tool` + `create_react_agent(model, tools=...)`，降低工具扩展成本。
  - 统一状态模型：TypedDict 建模工作流状态，便于阶段产物沉淀与复用。
- **传统流程（prod）**：
  - 沿用 Nova3/Loomi 流程控制，未使用 `StateGraph`；
  - 观测用 LangSmith，持久化以队列/文件或自定义结构为主；
  - 工具集成多为直接函数/类组装，缺少统一的 @tool 规范与自动 schema。

#### 影响评估
- **可维护性**：dev 将编排/工具层显式化（LangGraph/LangChain 收敛在 agents.graph 与工具层），业务与基础设施解耦更清晰，替换与测试边界明确。
- **可观测性**：Langfuse 便于自建/开源方案统一化；prod 的 LangSmith 在闭源云下观测链路成熟，但与自托管需求不一致。
- **演进成本**：dev 的学习曲线提高（StateGraph/检查点/中断机制），但换来更强的确定性与恢复能力。

#### 建议
- 中长期以 dev 的 LangGraph 编排为主干，结合 Langfuse 做全链路观测；
- 为 prod 分支提供最小侵入的迁移路径（逐模块引入 @tool 与局部 StateGraph 子流程），降低一次性改造风险。


