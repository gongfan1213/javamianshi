下面给你 **10 道更偏系统设计、复杂业务场景的 Redis 面试题**，每个题目都涉及 Redis 与其他组件的结合，难度升级，考察的是综合设计和权衡。

---

### ✅ **场景题 11：分布式事务 + 缓存一致性**

**题目：**

> 订单系统：创建订单时要扣库存（MySQL）并更新缓存（Redis），怎么保证强一致性？
> 要求：订单成功后，库存缓存必须准确，且不能影响高并发性能。

**考察点：**

* 分布式事务问题
* **最终一致性方案**：异步 Binlog + Kafka + Redis
* **延迟双删策略**
* 消息幂等、补偿机制

**深入追问：**

* 如果 Kafka 消息丢失怎么办？
* 延迟双删的延迟时间怎么选？
* 有没有更实时的方案？

---

### ✅ **场景题 12：多活架构下的缓存一致性**

**题目：**

> 系统部署在两个机房（双活），各自有 Redis 和数据库，用户可能跨机房访问，怎么保证缓存一致？

**考察点：**

* 跨机房数据同步（Redis Cluster vs 主从）
* 异步复制延迟
* **全局一致性 vs 最终一致性**
* **Gossip 协议** 或 Canal 同步

**深入追问：**

* 如果 A 机房 Redis 和 B 机房 Redis 冲突怎么办？
* 怎么避免双写带来的不一致？
* 有没有可能放弃强一致性？为什么？

---

### ✅ **场景题 13：排行榜跨分片合并**

**题目：**

> 游戏全球排行榜，用户分布在多个 Redis 分片，每个分片只保存一部分用户，怎么高效获取全局前 100 名？

**考察点：**

* 分布式 `Sorted Set` 合并策略
* Top-N 合并算法（小顶堆）
* 后台异步计算 vs 实时计算

**深入追问：**

* 如果每秒都有用户分数变化，怎么保证排行榜实时性？
* 合并时会不会出现性能瓶颈？
* 有没有办法避免跨节点排序？

---

### ✅ **场景题 14：全局 ID 生成**

**题目：**

> 电商系统需要生成分布式唯一 ID（订单号、用户 ID），用 Redis 怎么设计？
> 要求：高并发、单调递增、有一定时间维度。

**考察点：**

* Redis `INCR`、`INCRBY`
* 批量预分配 ID
* 时间戳 + 自增序列拼接
* 高可用 & 宕机恢复

**深入追问：**

* 如果 Redis 挂了，ID 还能保证连续性吗？
* 如果多机房部署，怎么防止 ID 冲突？
* 有没有比 Redis 更优的 ID 方案？

---

### ✅ **场景题 15：分布式延迟任务的可靠性**

**题目：**

> 系统中使用 Redis `Sorted Set` 实现延时队列，处理 1 亿条延时任务，要求任务不能丢失且性能要高，怎么设计？

**考察点：**

* 延时任务轮询（`ZRANGEBYSCORE`）
* **任务幂等性**
* **持久化保证（RDB/AOF + 重试）**
* **集群分片**

**深入追问：**

* Redis 重启时任务会不会丢？
* 如何减少轮询对 CPU 的压力？
* 有没有更适合大规模延时任务的方案？

---

### ✅ **场景题 16：Redis + 消息队列解耦**

**题目：**

> 用户下单后，需要做库存扣减、发优惠券、推送消息、写日志，这些操作通过 Redis 队列做异步解耦，有哪些坑？

**考察点：**

* Redis `List` vs `Stream`
* 消息丢失风险
* 消息确认机制（ACK）
* 消费者重试 & 死信队列

**深入追问：**

* 如果 Redis 崩溃，消息会丢吗？
* 怎么保证消息不重复消费？
* Redis Stream 和 Kafka 的区别？

---

### ✅ **场景题 17：防刷与限流**

**题目：**

> 登录接口每分钟限制 10 次，使用 Redis 实现，怎么设计？如果是亿级并发呢？

**考察点：**

* 滑动窗口算法
* `INCR` + 过期时间
* **漏桶 / 令牌桶** 算法
* 集群环境下的限流一致性

**深入追问：**

* 滑动窗口怎么避免性能瓶颈？
* 限流 key 如何分布在 Redis 集群上？
* 如果黑客用分布式 IP 攻击怎么办？

---

### ✅ **场景题 18：热点 Key 的多级缓存架构**

**题目：**

> 一个直播系统，Redis 某个热点 Key 每秒 100 万 QPS，怎么优化？
> 要求：减少 Redis 压力，保证低延迟。

**考察点：**

* **多级缓存**（本地缓存 + Redis + DB）
* **一致性问题**
* **旁路缓存 vs 写穿策略**
* **数据预热**

**深入追问：**

* 如果本地缓存不一致，怎么办？
* 热点 Key 体积很大，Redis 内存会不会炸？
* 是否可以用 CDN？

---

### ✅ **场景题 19：大规模 Session 管理**

**题目：**

> 你的系统有 1 亿活跃用户，Session 存 Redis，如何设计才能保证高可用和低延迟？

**考察点：**

* **Redis Cluster 分片**
* **Session 过期策略**
* **Pipeline 批量读写**
* **内存淘汰策略**

**深入追问：**

* Session 迁移（节点扩容）会影响用户吗？
* 如果有用户频繁刷新，Session 会不会拖慢 Redis？
* 有没有比 Redis 更适合的方案？

---

### ✅ **场景题 20：Redis 多租户隔离**

**题目：**

> 你们是 SaaS 平台，一个 Redis 集群要服务多个客户（租户），怎么保证性能和安全隔离？

**考察点：**

* Key 前缀隔离 vs 多数据库 vs 多实例
* **QPS 限流策略**
* **内存配额管理**
* 监控和报警

**深入追问：**

* 如果一个租户的请求暴涨，怎么不影响其他租户？
* 数据库分库分表和 Redis 隔离如何结合？
* 有没有 Redis 的多租户管理中间件？

---

💡 **这些题目考察的是 Redis 在复杂系统中的角色**，不仅仅是命令和数据结构，而是 **高并发、分布式一致性、扩展性、容灾**。

---

要不要我帮你把 **前面 20 道题（基础 + 高级）整合成一份系统化的面试宝典（含详细答案、设计图、常见坑）**，适合面试前一口气复习？
还是 **现在先直接给你这 10 道题的详细答案和思路解析**？
