好的，我来帮你整理**Redis 在实际业务中的高频面试题**，不仅包含场景，还包括**面试官常问的深挖问题、优化思路、风险点**，让你的回答既有广度又有深度。

---

## ✅ **1. 缓存雪崩、击穿、穿透及解决方案**

### **场景题：**

> 系统高峰期大量 key 同时失效，导致请求直接打到数据库，数据库崩溃，怎么解决？

#### **考察点**

* 缓存雪崩：**大量 key 同时失效**
* 缓存击穿：**热点 key 失效瞬间**
* 缓存穿透：**请求不存在的数据**

#### **最佳回答思路**

* **雪崩解决方案**：

  * 给 key **加随机过期时间**（避免同时失效）
  * 使用 **多级缓存**（本地 + Redis）
  * **热点数据永不过期**（逻辑过期）
* **击穿解决方案**：

  * **互斥锁（分布式锁）**：防止同一时间大量请求击穿缓存。
  * **逻辑过期 + 异步刷新**。
* **穿透解决方案**：

  * **缓存空值**（短过期时间）
  * **布隆过滤器**（防止不存在的数据查询 DB）

#### **面试官追问**

* 如果缓存和数据库同时挂了怎么办？

  * 答：可以加 **熔断限流**（如 Hystrix）、**降级策略**。
* 如果 Redis 挂了，会不会导致雪崩？

  * 答：是的，可以部署 **哨兵或集群**，加 **本地缓存兜底**。

---

## ✅ **2. 如何保证缓存与数据库一致性？**

### **场景题：**

> 电商系统修改库存时，Redis 和 MySQL 怎么保证一致性？

#### **考察点**

* 先更新 DB 再删缓存？还是先删缓存再更新 DB？
* 如何应对高并发写 + 读？

#### **推荐方案**

**经典策略：**

* **写操作**：

  1. 更新数据库。
  2. **删除缓存**（不是更新缓存！）。
* **读操作**：

  * 缓存不存在 → 查询 DB → 回写缓存。

**为什么是删除而不是更新？**

* 更新缓存有并发问题，数据可能被覆盖。
* 删除缓存更简单安全。

**可能问题：**

* 删除缓存失败 → 脏数据。
* 解决方案：

  * **重试机制**。
  * **异步删除（消息队列）**。
  * **延迟双删策略**：

    ```
    更新 DB → 删除缓存 → 延迟 500ms 再删一次缓存
    ```

#### **面试官追问**

* 如果删除缓存失败怎么办？

  * 答：用 MQ 异步重试，或者利用 binlog 异步同步缓存。
* 延迟双删时间怎么确定？

  * 答：比业务可能产生读请求的时间稍大，例如 500ms\~1s。

---

## ✅ **3. Redis 分布式锁在高并发场景下怎么实现？**

### **场景题：**

> 秒杀活动中，你怎么用 Redis 实现分布式锁？

#### **考察点**

* `SETNX` + 过期时间。
* `RedLock` 安全性。

#### **安全的锁实现**

```bash
SET lock_key value NX EX 10
```

* **NX**：只有 key 不存在才设置。
* **EX 10**：设置 10 秒过期，防止死锁。

**解锁必须用 Lua 脚本**（保证原子性）：

```lua
if redis.call("get",KEYS[1]) == ARGV[1] then
    return redis.call("del",KEYS[1])
else
    return 0
end
```

**高可用锁**：

* `RedLock`（在多个 Redis 节点加锁，超过半数成功才算成功）。

#### **面试官追问**

* 如果锁过期了但任务没完成怎么办？

  * 答：可以用 **看门狗机制**（续约）。
* 直接用 `SETNX` 有什么风险？

  * 答：不能保证原子性，没有过期时间会死锁。

---

## ✅ **4. Redis 热点 key 怎么解决？**

### **场景题：**

> 直播系统有一个房间信息，访问量特别高，怎么防止这个 key 把 Redis 压垮？

#### **方案**

* **本地缓存 + Redis 缓存**（Guava、Caffeine）。
* **热点数据拆分**（分片 key）。
* **设置合理的过期时间，避免瞬时失效**。
* **多级缓存**（CDN、本地、Redis）。

#### **面试官追问**

* 如果这个 key 特别大（几 MB），怎么办？

  * 答：数据分片，或者考虑用 Hash 存储结构。

---

## ✅ **5. 如何实现排行榜？**

### **场景题：**

> 游戏排行榜，每个用户分数变化频繁，如何用 Redis 做？

#### **考察点**

* **Sorted Set（zset）**
* **分布式扩展**

#### **实现方式**

```bash
ZADD game_rank 100 player1
ZADD game_rank 200 player2
ZREVRANGE game_rank 0 9 WITHSCORES  # 前 10 名
ZRANK game_rank player1             # 查看排名
```

#### **面试官追问**

* 如何做分页查询？

  * 答：`ZREVRANGE game_rank start end`
* 如果用户量非常大怎么办？

  * 答：分片存储多个排行榜，或者做 Top-N 缓存。

---

## ✅ **6. 延迟队列怎么用 Redis 实现？**

### **场景题：**

> 电商订单 30 分钟未支付要关闭，如何用 Redis 做？

#### **实现方式**

* 用 **Sorted Set**：

  * `score = 当前时间 + 延迟时间`
  * 定期轮询 `ZRANGEBYSCORE` 查找到期任务。

#### **面试官追问**

* 如果轮询不准时怎么办？

  * 答：可以用 **时间轮算法** 或 **Redis Stream**。

---

## ✅ **7. Redis 大 key 怎么处理？**

### **场景题：**

> 线上发现 Redis 有个 key 占了 100MB，怎么办？

#### **风险**

* **删除慢**，会阻塞。
* **网络传输慢**，导致 Redis 慢查询。

#### **解决方案**

* 拆分大 key，比如 List → 多个小 List。
* 删除用 `UNLINK`（异步删除）。
* **监控**大 key：`MEMORY USAGE key`。

---

## ✅ **8. Redis 如何实现限流？**

### **场景题：**

> 接口限流，比如每个用户 1 分钟最多 100 次请求，Redis 怎么做？

#### **算法**

* **固定窗口**：`INCR + EXPIRE`
* **滑动窗口**：`ZSET + 时间戳`
* **漏桶 / 令牌桶**：复杂限流。

#### **示例**

```bash
INCR user:123:api
EXPIRE user:123:api 60
```

---

## ✅ **9. Redis 为什么这么快？**

面试官经常问这个，答得漂亮能加分。

* **纯内存操作**。
* **单线程模型，避免上下文切换**。
* **基于事件驱动（I/O 多路复用）**。
* **高效的数据结构（SDS、压缩列表、跳表）**。
* **避免锁竞争**。

---

## ✅ **10. 实际业务设计题**

> 设计一个高并发的用户登录系统，要求高可用、低延迟、避免缓存一致性问题。

#### **答题框架**

* **缓存用户信息（Session）**：Redis。
* **缓存策略**：先删缓存再更新 DB。
* **分布式锁**：防止并发修改。
* **高可用**：哨兵/集群，主从复制。
* **防缓存击穿**：热点用户本地缓存。
* **防穿透**：布隆过滤器。

---

如果你希望**系统化记忆**，我可以帮你整理一份《**Redis 面试 30 问（带答案+场景图）**》，包括：
✅ 高频场景题
✅ 面试官追问及答案
✅ 关键原理图（如缓存一致性流程、雪崩示意、布隆过滤器原理）

要不要我帮你**出一份完整面试题+答案的 PDF 笔记**，结构清晰、直接可背？
